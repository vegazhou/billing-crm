select "CODE", orderid, scheme_id, type, decode(type, 'PSTN_SINGLE_PACKAGE', '05', 'BY_HOSTS', '03', 'BY_PORTS', '03', 'MISC', '05', 'WEBEX_STORAGE', '03', 'CMR_MONTHLY_PAY', '03') as feetype, "MONTHLYFEE","HOSTS","UNITPRICE","SITE","STATE","EFFECTIVESTARTDATE","EFFECTIVEENDDATE"
from MAINPRODUCT_MONTHLYFEE
where
(((EFFECTIVEENDDATE >= '2017-04-01 00:00:00' and EFFECTIVEENDDATE <= '2017-04-15 00:00:00') AND SUBSTR(EFFECTIVESTARTDATE, 9, 2) >= '16')
or
(EFFECTIVESTARTDATE >= '2017-03-16 00:00:00' and EFFECTIVESTARTDATE <= '2017-04-15 00:00:00')
or
(EFFECTIVESTARTDATE < '2017-03-16 00:00:00' and EFFECTIVEENDDATE > '2017-04-15 00:00:00'))
and
(type = 'BY_PORTS' or type = 'BY_HOSTS' or type = 'WEBEX_STORAGE' or type = 'CMR_MONTHLY_PAY')
and EFFECTIVESTARTDATE != EFFECTIVEENDDATE
union all
select "CODE",orderid, scheme_id, type, decode(type, 'PSTN_SINGLE_PACKAGE', '05', 'BY_HOSTS', '03', 'BY_PORTS', '03', 'MISC', '05') as feetype, "MONTHLYFEE","HOSTS","UNITPRICE","SITE","STATE","EFFECTIVESTARTDATE","EFFECTIVEENDDATE"
from MAINPRODUCT_MONTHLYFEE
where
(EFFECTIVESTARTDATE >= '2017-04-01 00:00:00' and EFFECTIVESTARTDATE <= '2017-04-31 00:00:00')
and
(type = 'PSTN_SINGLE_PACKAGE')
and EFFECTIVESTARTDATE != EFFECTIVEENDDATE
UNION ALL
select "CODE",orderid, scheme_id, type, decode(type, 'PSTN_SINGLE_PACKAGE', '05', 'BY_HOSTS', '03', 'BY_PORTS', '03', 'MISC', '05') as feetype, "MONTHLYFEE","HOSTS","UNITPRICE","SITE","STATE","EFFECTIVESTARTDATE","EFFECTIVEENDDATE"
from MAINPRODUCT_MONTHLYFEE
where
(EFFECTIVESTARTDATE >= '2017-04-01 00:00:00' and EFFECTIVESTARTDATE <= '2017-04-31 00:00:00')
and
(type = 'MISC')